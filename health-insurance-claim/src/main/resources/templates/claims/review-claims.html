<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Review Claims</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/assets/css/style.css}">
	<style>
		body {
			background-color: #f5f7fa;
			font-family: 'Poppins', sans-serif;
			display: flex;
			flex-direction: column;
			min-height: 100vh;
			font-family: 'Poppins',sans-serif;

		}

		main {
			flex: 1;
		}

		.claims-container {
			max-width: 1200px;
			margin: 3rem auto;
			background: #fff;
			border-radius: 12px;
			box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
			padding: 2rem;
		}

		.table th {
			background-color: #2c3e50;
			color: white;
			font-weight: 500;
		}

		.table td,
		.table th {
			vertical-align: middle;
			text-align: center;
		}

		.status-badge {
			font-weight: 600;
			padding: 0.5rem 1rem;
			border-radius: 20px;
		}

		.action-buttons form {
			display: inline;
			margin-left: 5px;
		}
	</style>
</head>

<body>

	<!-- Navbar -->
	<div th:replace="~{fragments/navbar :: navbar}"></div>

	<main>
		<div class="container claims-container">
			<h3 class="text-center mb-4">Review Claims</h3>

			
			
			<!-- No claims -->
			<div th:if="${#lists.isEmpty(claims)}" class="text-center text-muted">
				<i class="bi bi-inbox display-6"></i>
				<p class="mt-3">No claims found.</p>
			</div>

			<!-- Claims Table -->
			<div th:if="${!#lists.isEmpty(claims)}">
				
				<table class="table table-striped">
					<thead>
						<tr>
							<th>Claim ID</th>
							<th>Policy Number</th>
							<th>Claim Amount</th>
							<th>Claim Status</th>
							<th>Adjuster</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="claim : ${claims}">
							<td th:text="${claim.claimId}">1</td>
							<td th:text="${claim.policy.policyNumber}">POL123</td>
							<td th:text="'₹ ' + ${claim.claimAmount}">₹ 5000</td>
							<td>
								<span th:if="${claim.claimStatus == null}" class="badge bg-secondary">Pending</span>
								<span th:if="${claim.claimStatus != null and claim.claimStatus.name() == 'PENDING'}"
									class="badge bg-warning text-dark">Pending</span>
								<span th:if="${claim.claimStatus != null and claim.claimStatus.name() == 'APPROVED'}"
									class="badge bg-success">Approved</span>
								<span th:if="${claim.claimStatus != null and claim.claimStatus.name() == 'REJECTED'}"
									class="badge bg-danger">Rejected</span>
							</td>
							<td th:text="${claim.adjuster != null ? claim.adjuster.username : 'Not Assigned'}"></td>
							<td class="action-buttons">
								<!-- View claim: all roles -->
								<a th:href="@{/claims/{claimId}(claimId=${claim.claimId})}"
									class="btn btn-sm btn-primary">View</a>

								<!-- Assign adjuster: only Admin -->
								<form th:if="${userRole == 'ADMIN'}" th:action="@{/claims/assign}" method="post">
									<input type="hidden" name="claimId" th:value="${claim.claimId}" />
									<select name="adjusterId" class="form-select form-select-sm mt-1 mb-1" required>
										<option value="">--Select Adjuster--</option>
										<option th:each="u : ${adjusters}" th:value="${u.userId}"
											th:text="${u.username}"></option>
									</select>
									<button type="submit" class="btn btn-sm btn-success">Assign</button>
								</form>

								<!-- Update status: Admin & Adjuster -->
								<form th:if="${userRole == 'ADMIN' or userRole == 'CLAIM_ADJUSTER'}"
									th:action="@{/claims/{claimId}/status(claimId=${claim.claimId})}" method="post">
									<select name="status" class="form-select form-select-sm mt-1 mb-1" required>
										<option value="PENDING"
											th:selected="${claim.claimStatus == null or claim.claimStatus.name() == 'PENDING'}">
											Pending</option>
										<option value="APPROVED"
											th:selected="${claim.claimStatus != null and claim.claimStatus.name() == 'APPROVED'}">
											Approved</option>
										<option value="REJECTED"
											th:selected="${claim.claimStatus != null and claim.claimStatus.name() == 'REJECTED'}">
											Rejected</option>
									</select>
									<button type="submit" class="btn btn-sm btn-warning">Update Status</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</main>

	<!-- Footer -->
	<div th:replace="~{fragments/footer :: footer}"></div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:src="@{/assets/js/script.js}"></script>
</body>

</html>